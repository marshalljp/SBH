!function(d){"use strict";var l,c,u,m,f,h,v,p,g,b,R,_,k,C,x,y,D,w,N,P,S,I,M,E,r,n,T,A,j,F,O,L,V,q,B,Y,W,G,H,J,a,U,z,Q,X,K,Z,$,ee,ae,te,oe,ie,se,re,ne,le=86400,ce=!1,de=!1,ue=[],me=[],fe="YYYY-MM-DD",he=!1,s=1,t=parseInt(2*Number.MAX_SAFE_INTEGER/3,10),ve=t,pe=t,ge=t,be=!1,Re=!1,_e=-1,ke=-1,Ce=!1,xe={},ye=!1,De=!1,o=!1;function we(){var e,a=!1,t=!1;if(Me(),!1!==De)for(var o,i,s=G;s<H;s+=le)De[s]&&"available"==De[s].status&&(i=De[s],o=loftoceanRoomReservation.pricePerPerson?Le(qe(i.adult_price,Y),qe(W,i.child_price)):i.price,i=i.special_price_rate?qe(o,i.special_price_rate):o,(!1===a||Number(i)<Number(a))&&(a=i),(!1===t||Number(o)<Number(t))&&(t=o));!1!==a&&(e="",e=a<t?"<del>"+je(t)+'</del> <span class="sale">'+je(a)+"</span>":je(a),p.html(e))}function Ne(){var e=void 0===g.data("min")||isNaN(g.data("min"))?1:g.data("min"),a=void 0===g.data("min")||isNaN(g.data("min"))?t:g.data("max");e<B?R.removeClass("disabled").data("status",""):R.addClass("disabled").data("status","disabled"),B<a?b.removeClass("disabled").data("status",""):b.addClass("disabled").data("status","disabled")}function i(){j=T.data("value"),F=A.data("value"),Ie(),Se(),function(){if(u.length){var e=!1,a=!1;clearTimeout(he),u.removeClass("show"),g.removeData("max");for(var t=G;t<H;t+=le){if(!P[t]||"available"!=P[t].status||!P[t].available_number){a=!0;break}(!1===e||Number(P[t].available_number)<e)&&(e=Number(P[t].available_number))}!a&&!1!==e&&0<e&&(g.data("max",e),e<B&&(u.find(".room-error-limit-number").text(e),g.val(e-1).siblings(".plus").trigger("click"),u.addClass("show"),he=setTimeout(function(){u.removeClass("show")},3e3))),Ne()}}(),we(),Ae()}function Pe(){var e;de?(e={roomID:loftoceanRoomReservation.roomID,checkin:G,checkout:H,action:loftoceanRoomReservation.getFlexiblePriceRuleAjaxAction},m.html(""),f.html(""),h.addClass("loading"),d.ajax(loftoceanRoomReservation.ajaxURL,{method:"GET",data:e}).done(function(e,a){e=e?JSON.parse(e):{},ce=!(!e||!e.status||1!=e.status)&&e.discount}).fail(function(){ce=!1}).always(function(){i(),h.removeClass("loading")})):i()}function Se(){var e=l.find(".cs-form-group.cs-extra-service-group .extra-service-switcher:checked"),r=0;e.length&&e.each(function(){var e=d(this).parent(),a="extra_service_"+d(this).val(),t=e.find('input[name="extra_service_price['+a+']"]').val();switch(e.find('input[name="extra_service_calculating_method['+a+']"]').val()){case"custom":var o=e.parent().find('input[name="extra_service_quantity['+a+']"]').val();r=Le(r,qe(t,o));break;case"auto_custom":o=e.parent().find('input[name="extra_service_quantity['+a+']"]').val();r=Le(r,qe(qe(t,o),(H-G)/le));break;case"auto":var i,s=e.find('input[name="extra_service_auto_calculating_unit['+a+']"]').val();["night-room"].includes(s)&&(t=qe(t,parseInt(B,10))),["person","night-person"].includes(s)&&(i=e.find('input[name="extra_service_auto_calculating_custom_adult_price['+a+']"]'),o=e.find('input[name="extra_service_auto_calculating_custom_child_price['+a+']"]'),t=i.length&&o.length?(i=i.val()?i.val():0,o=o.val()?o.val():0,Le(qe(i,parseInt(Y,10)),qe(o,parseInt(W,10)))):qe(t,parseInt(Y,10)+parseInt(W,10))),["night","night-person","night-room"].includes(s)&&(t=qe(t,(H-G)/le)),r=Le(r,t);break;default:r=Le(r,t)}}),S=r}function Ie(){var e=new Date(j),a=new Date(F),t=Te(e),o=Te(a),i=0,s=0,r=0;if(void 0===P[o-le])e.setDate(e.getDate()-15),a.setDate(a.getDate()+15),e=Oe(e),a=Oe(a),w&&e&&a&&d.ajax({url:wpApiSettings.root+"loftocean/v1/get_room_availability/"+(new Date).getTime(),data:{rid:w,start:e,end:a},type:"POST",success:function(e,a){"object"==typeof e&&(e.forEach(function(e){P[e.id]=e}),Ie(),Se(),Ae())},error:function(e){console.log(N.getRemotePriceListErrorMessage)}});else{if(Me(),!1!==De)for(var n,l,c=t;c<o;c+=le)De[c]&&"available"==De[c].status&&(l=(n=De[c]).special_price_rate||1,i=Le(i,qe(n.price,l)),s=Le(s,qe(n.adult_price,l)),r=Le(r,qe(n.child_price,l)));I=i,M=s,E=r}}function Me(){var e=j+"-"+F+"-"+Y+"-"+W;if(e!=o){o=e,De={};for(var a,t=G;t<H;t+=le)P[t]&&"available"==P[t].status?(a=function(e){var a={price:P[e].price,adult_price:P[e].adult_price,child_price:P[e].child_price};{var t;loftoceanRoomReservation.variablePrices.enable&&(Ce&&Ee(a,xe,e,ye),!1!==(t=function(c){var d=-1,u=NaN,m=NaN;loftoceanRoomReservation.customVariablePrices&&Array.isArray(loftoceanRoomReservation.customVariablePrices)&&loftoceanRoomReservation.customVariablePrices.forEach(function(e,l){e.hasOwnProperty("dateRange")&&e.hasOwnProperty("prices")&&e.hasOwnProperty("guestMode")&&Array.isArray(e.dateRange)&&e.dateRange.forEach(function(e){var a,t,o,i=parseInt(e.start_date_timestamp,10),s=parseInt(e.end_date_timestamp,10),r=isNaN(i),n=isNaN(s);r&&n||!(r||i<=c)||!(n||c<=s)||(d<0?(d=l,u=i,m=s):u+"-"+m!=i+"-"+s&&(a=isNaN(u),t=isNaN(m),o=!r&&(a||u<=i),e=!n&&(t||s<=m),(r&&a&&!t&&e||n&&t&&!a&&o||o&&e)&&(d=l,u=i,m=s)))})});return-1<d&&loftoceanRoomReservation.customVariablePrices[d]}(e))&&Ee(a,t.prices,e,"group"==t.guestMode))}return a}(t),De[t]=d.extend({},P[t],a)):De[t]=d.extend({},P[t])}}function Ee(i,s,r,n){var e=Xe(Y)+Xe(W);(n?["adult"+Y+"-child"+W,"adult"+Y+"-child","adult-child"+W,"adult-child"]:["guests"+e,"guests"]).every(function(e){if(s.hasOwnProperty(e)){var a,t,o=s[e];return"per_person"==loftoceanRoomReservation.variablePrices.mode?n?["adult_price","child_price"].forEach(function(e){var a="weekend_"+e;"yes"==P[r].is_weekend&&!isNaN(o[a])&&-1<o[a]?i[e]=o[a]:!isNaN(o[e])&&-1<o[e]&&(i[e]=o[e])}):(a="price",t="weekend_price","yes"==P[r].is_weekend&&!isNaN(o[t])&&-1<o[t]?(i.adult_price=o[t],i.child_price=o[t]):!isNaN(o[a])&&-1<o[a]&&(i.adult_price=o[a],i.child_price=o[a])):(a="price",t="weekend_price","yes"==P[r].is_weekend&&!isNaN(o[t])&&-1<o[t]?i.price=o[t]:!isNaN(o[a])&&-1<o[a]&&(i.price=o[a])),!1}return!0})}function Te(e){return void 0===e||e.getTime||(e=new Date),Math.floor(e.getTime()/le/1e3)*le}function Ae(){var e=loftoceanRoomReservation.pricePerPerson?Le(qe(M,Y),qe(E,W)):qe(I,B);!1!==ce&&ce.totleDiscount?e=qe(r=e,ce.totleDiscount):r=e,n=e,function(){var e=[],a=Le(n,S),t={totalBasePrice:je(r,!0),nights:(H-G)/le,totalPrice:je(a,!0),totalOriginalPrice:a};if(S&&(t.extraService=je(S,!0)),!1!==ce&&ce.discount.base_percentage&&Object.keys(ce.discount.details).forEach(function(e){var a=ce.discount.details[e];t[e]="-"+je(qe(r,a.discount))}),Me(),!1!==De)for(var o,i,s=G;s<H;s+=le)De[s]&&("available"==De[s].status?(o=(i=De[s]).special_price_rate||1,i=loftoceanRoomReservation.pricePerPerson?Le(qe(i.adult_price,Y),qe(i.child_price,W)):qe(i.price,B),e.push({date:moment(P[s].start).format(Q),originalPrice:je(i,!0),price:je(qe(i,o),!0)})):e.push({date:moment(P[s].start).format(Q),price:!1}));t.rooms=e,Je(a,t),v.html("").append(J(t)),c.html(t.totalPrice)}()}function je(e,a){var t,o=0,i=0,s="";e=void 0===e?0:(t=e,!isNaN(t)&&isFinite(t)?e:0);try{o=(""+e).split(".")[1].length}catch(e){o=0}if(e=Number(e).toFixed(o?Math.max(0,loftoceanRoomReservation.currencySettings.precision):0),e=(""+e).split("."),s=Number(e[0]),loftoceanRoomReservation.currencySettings.thousandSeparator&&1e3<(i=Number(e[0]))){for(s=(i+"").substr(-3),i=Math.floor(i/1e3);1e3<i;)s=(i+"").substr(-3)+loftoceanRoomReservation.currencySettings.thousandSeparator+s,i=Math.floor(i/1e3);0<i&&(s=i+loftoceanRoomReservation.currencySettings.thousandSeparator+s)}return 1<e.length&&0<Number(e[1])&&loftoceanRoomReservation.currencySettings.precision&&loftoceanRoomReservation.currencySettings.decimalSeparator&&(s+=loftoceanRoomReservation.currencySettings.decimalSeparator+e[1]),a?s:loftoceanRoomReservation.currency.left+s+loftoceanRoomReservation.currency.right}function Fe(e){return 9<e?e:"0"+e}function Oe(e){return"Invalid Date"===e.toString()?"":e.getFullYear()+"-"+Fe(e.getMonth()+1)+"-"+Fe(e.getDate())}function Le(e,a){var t,o,i;try{t=(""+e).split(".")[1].length}catch(e){t=0}try{o=(""+a).split(".")[1].length}catch(e){o=0}return i=Math.max(t,o),((e*Math.pow(10,i)+a*Math.pow(10,i))/Math.pow(10,i)).toFixed(i)}function Ve(e,a){return Le(e,-a)}function qe(e,a){var t,o;try{t=(""+e).split(".")[1].length}catch(e){t=0}try{o=(""+a).split(".")[1].length}catch(e){o=0}return(e*Math.pow(10,t)*(a*Math.pow(10,o))/Math.pow(10,t+o)).toFixed(t+o)}function Be(c){if(loftoceanRoomReservation.unavailableDates&&loftoceanRoomReservation.unavailableDates.length){var d=-1,u=NaN,m=NaN;return loftoceanRoomReservation.unavailableDates.forEach(function(e,a){var t,o,i="custom"!=e.type,s=i?NaN:parseInt(e.start,10),r=i?NaN:parseInt(e.end,10),n=isNaN(s),l=isNaN(r);(i||(n||s<=c)&&(l||c<=r))&&(d<0?(d=a,u=s,m=r):"custom"!=e.type||n&&l||u+"-"+m==s+"-"+r||(t=isNaN(u),o=isNaN(m),i=!n&&(t||u<=s),e=!l&&(o||r<=m),(t&&o&&(!n||!l)||n&&t&&!o&&e||l&&o&&!t&&i||i&&e)&&(d=a,u=s,m=r)))}),-1<d&&loftoceanRoomReservation.unavailableDates[d]}return!1}function Ye(e,a){if(e=e.format(fe),void 0!==a&&null!==a.startDate&&null===a.endDate||!ue.includes(e)){var t=void 0!==a&&null!==a.startDate&&null===a.endDate;if(t){if(moment(e).isBefore(a.startDate))return[!1,"",""];if(me.length){if(me.includes(e))return[!1,"",""];var o=a.startDate.clone(),i=moment(e);for(o.add("1","day");o.isBefore(i);){if(ue.includes(o.format(fe)))return[!1,"",""];o.add("1","day")}}}var s=new Date(e),r="day"+s.getDay(),n=Te(s),l=[],c=[],e=!1,s=Be(n),e=t&&Be(Te(new Date(a.startDate.format(fe))));return!1!==s&&(s.checkin&&s.checkin.length&&s.checkin.includes(r)&&(l.push("no-checkin","checkin-unavailable"),c.push(N.noCheckin)),t?s.checkout&&s.checkout.length&&s.checkout.includes(r)&&(l.push("no-checkout","checkout-unavailable"),c.push(N.noCheckout)):s.in_advance&&((s=s.in_advance).min&&(n-z)/le<s.min&&l.push("disabled","checkin-unavailable"),s.max&&(n-z)/le>s.max&&(l.push("checkin-unavailable"),void 0!==a&&null!==a.startDate&&null===a.endDate||l.push("disabled")))),!1!==e&&t&&e.stay_length&&(t=Te(new Date(a.startDate.format(fe))),a="day"+a.startDate.day(),t<n&&(e=e.stay_length,t=(n-t)/le,e[a]&&(e[a].min&&t<e[a].min&&(l.push("minimal-stay-unavailable","checkout-unavailable"),c.push(e[a].min+N.minimum)),e[a].max&&t>e[a].max&&(l.push("off","disabled","maximal-stay-unavailable","checkout-unavailable"),c.push(e[a].max+N.maximum))))),[!0,l.length?l.join(" "):"",c.length?c.join(", "):""]}return[!1,"",""]}function We(e,a){T.val(moment(e).format(Q)).data("value",e),A.val(moment(a).format(Q)).data("value",a),O&&(V.text(moment(e).format(Q)),q.text(moment(a).format(Q)).css("opacity","")),j=e,G=Te(new Date(e)),F=a,H=Te(new Date(a)),He(G,H),Pe()}function Ge(e,a){for(var t=0,o=0,i=e.clone(),s=null;t++<70;){var r=Ye(i);if(!r[0]||r[1]&&r[1].split(" ").includes("checkin-unavailable"))i.add("1","day");else{o=0,s=i.clone().add("1","day");for(var n={startDate:i,endDate:null};o++<70;){var l=Ye(s,n);if(!(!l[0]||l[1]&&l[1].split(" ").includes("checkout-unavailable")))return{checkin:i.format(fe),checkout:s.format(fe)};s.add("1","day")}i.add("1","day")}}return{checkin:e.format(fe),checkout:a.format(fe)}}function He(s,r){var n,e;X&&K&&(K=!(n=[]),loftoceanRoomReservation.extraServices.forEach(function(a){if(""!==a.effective_time&&a.custom_effective_time_slots.length){var t=K=!0,o="activated"==a.effective_time;for(let e=0;e<a.custom_effective_time_slots.length;e++){var i=a.custom_effective_time_slots[e];if((!i.start_timestamp||i.start_timestamp<=s)&&(!i.end_timstamp||i.end_timstamp>=r)){o?n.push(d.extend({},a)):t=!1;break}}!o&&t&&n.push(d.extend({},a))}else n.push(d.extend({},a))}),(e=d("#secondary .cs-form-group.cs-extra-service-group")).length&&e.remove(),n.length&&Z.before(a({currency:loftoceanRoomReservation.currency,services:n})))}function Je(e,a){var t;loftoceanRoomReservation.isTaxEnabled&&(loftoceanRoomReservation.taxIncluded?(t=function(e){var a=Le(loftoceanRoomReservation.currencySettings.precision,2),t=loftoceanRoomReservation.taxRate,o=[],i=e,s=0;if(t.reversed_compound_rates&&t.reversed_compound_rates.length)for(var r=0;r<t.reversed_compound_rates.length;r++)i=qe(s=i,100/(100+t.reversed_compound_rates[r].rate)),i=Number(i).toFixed(a),o.unshift({tax:je(Ve(s,i)),label:t.reversed_compound_rates[r].label});if(t.regular_rates&&t.regular_rates.length){for(var n=100,r=0;r<t.regular_rates.length;r++)n=Le(n,t.regular_rates[r].rate);for(i=qe(i,100/n),i=Number(i).toFixed(a),--r;0<=r;r--)o.push({tax:je(qe(i,t.regular_rates[r].rate/100)),label:t.regular_rates[r].label})}return{totalTax:Ve(e,i),taxDetails:o}}(e),a.tax=je(t.totalTax),a.taxDetails=t.taxDetails):(t=function(e){var a=loftoceanRoomReservation.taxRate,t=e,o=0,i=[];if(a.regular_rates&&a.regular_rates.length){for(var s=0,r=0;r<a.regular_rates.length;r++)s=qe(e,a.regular_rates[r].rate/100),i.push({tax:je(s),label:a.regular_rates[r].label}),o=Le(o,s);t=Le(e,o)}if(a.compound_rates&&a.compound_rates.length)for(var n=0,r=0;r<a.compound_rates.length;r++)n=qe(t,a.compound_rates[r].rate/100),o=Le(o,n),t=Le(t,n),i.push({tax:je(n),label:a.compound_rates[r].label});return{totalTax:o,taxDetails:i}}(e),a.tax=je(t.totalTax),a.taxDetails=t.taxDetails,a.beforeTax=a.totalPrice,a.totalPrice=je(Le(a.totalOriginalPrice,t.totalTax),!0)))}function Ue(){ae&&(re?function(){var e=W,a=!1;te&&e<(s=ie*B)&&(e=s,a=!0);oe&&(ve=se*B)<e&&(e=ve,a=!0);Re&&(ge=ke*B)<e&&(e=ge,a=!0);a&&x.val(e-1).siblings(".plus").trigger("click",!0)}:ne?function(){var e=Y,a=!1;te&&e<(s=ie*B)&&(e=s,a=!0);oe&&(ve=se*B)<e&&(e=ve,a=!0);Re&&(pe=ke*B)<e&&(e=pe,a=!0);a&&_.val(e-1).siblings(".plus").trigger("click",!0)}:function(){var e=Y,a=W,t=!1,o=!1,i=e+a;pe=be?_e*B:pe,ge=Re?ke*B:ge,!te||i<(s=ie*B)&&(e-=i-s,i=parseInt(e,10)+parseInt(a,10),t=!0);oe&&(ve=se*B)<i&&(o=!0,(a-=i-ve)<0&&(e+=a,o=!["0",a=0].includes(W),e=Math.max(1,e),t=!0));be&&pe<e&&(a-=pe-e,e=pe,o=t=!0);Re&&ge<a&&(a=ge,o=!0);t&&(W=a,Y=e-1,_.val(Y).siblings(".plus").trigger("click",!0));o&&(1<a?(W=a-1,x.val(W).siblings(".plus").trigger("click",!0)):(W=a+1,x.val(W).siblings(".minus").removeClass("disabled").removeAttr("disabled").trigger("click",!0)))})()}function ze(e){if(!ee)return!0;var a=void 0===e||!e,t=a?0:1,o=a?pe:ge,i=a?W:Y,e=a?Y:W;return!(parseInt(Y,10)+parseInt(W,10)===s&&t<i&&e<o)||(a?(x.siblings(".minus").trigger("click",!0),_.siblings(".plus").trigger("click",!0)):(_.siblings(".minus").trigger("click",!0),x.siblings(".plus").trigger("click",!0)),!1)}function Qe(e,a){var t=parseInt(Y,10)+parseInt(W,10);return a?t<ve&&function(e){if(be&&"adult"==e)return parseInt(Y,10)<pe;if(Re&&"child"==e)return parseInt(W,10)<ge;return!0}(e):s<t}function Xe(e){return isNaN(e)?0:parseInt(e,10)}function Ke(){var t,e=parseInt(Y,10),a=parseInt(W,10),o=parseInt(Y,10)+parseInt(W,10);o<ve?(be&&pe<=e?k.addClass("disabled").data("status","disabled").children().first().attr("data-title",N.adult.plus.general.replace("[number]",pe)).removeClass("hide"):k.removeClass("disabled").data("status","").children().addClass("hide"),Re&&ge<=a?y.addClass("disabled").data("status","disabled").children().first().attr("data-title",N.child.plus.general.replace("[number]",ge)).removeClass("hide"):y.removeClass("disabled").data("status","").children().addClass("hide")):(k.addClass("disabled").data("status","disabled").children().first().attr("data-title",N.adult.plus.maximum.replace("[number]",ve)).removeClass("hide"),y.addClass("disabled").data("status","disabled").children().first().attr("data-title",N.child.plus.maximum.replace("[number]",ve)).removeClass("hide")),C.removeClass("cs-hint"),D.removeClass("cs-hint"),s<o?(e=re?1:0,((a=re?0:1)<Y?C.removeClass("disabled").data("status","").children():C.addClass("disabled").data("status","disabled").children().first().attr("data-title",N.adult.minus.general.replace("[number]",a))).addClass("hide"),(e<W?D.removeClass("disabled").data("status","").children():D.addClass("disabled").data("status","disabled").children().first().attr("data-title",N.child.minus.general.replace("[number]",e))).addClass("hide")):(C.addClass("disabled").data("status","disabled"),Y<2?C.children().first().addClass("hide"):C.children().first().attr("data-title",N.adult.minus.minimum.replace("[number]",s)).removeClass("hide"),D.addClass("disabled").data("status","disabled"),W<(re?2:1)?D.children().first().addClass("hide"):D.children().first().attr("data-title",N.child.minus.minimum.replace("[number]",s)).removeClass("hide"),o===s&&ee&&(t={child:D,adult:C},["child","adult"].forEach(function(e){var a="child"==e;(a?0:1)<(a?W:Y)&&(a?Y:W)<(a?pe:ge)&&t[e].removeClass("disabled").data("status","").addClass("cs-hint").children().first().attr("data-title",N[e].minus.minimum.replace("[number]",s)).removeClass("hide")})))}document.addEventListener("DOMContentLoaded",function(){if("undefined"==loftoceanRoomReservation)return!1;var s,r,t;d("body"),l=d("#secondary .cs-reservation-form"),Q=loftoceanRoomReservation.displayDateFormat,ee=!!l.data("guests-field"),J=wp.template("loftocean-room-price-details"),a=wp.template("loftocean-room-extra-services"),X=loftoceanRoomReservation.extraServices&&loftoceanRoomReservation.extraServices.length,K=!0,p=d("#secondary .base-price"),h=d("#secondary .cs-room-booking"),v=d("#secondary .cs-form-price-details"),Z=l.find(".cs-form-total-price"),c=Z.find(".total-price-number"),P=loftoceanRoomReservation.priceList,w=loftoceanRoomReservation.roomID,N=loftoceanRoomReservation.i18nText,de=!!loftoceanRoomReservation.hasFlexibilePriceRules,T=l.find(".cs-check-in input[name=checkin]"),A=l.find(".cs-check-out input[name=checkout]"),g=l.find(".cs-rooms input[name=room-quantity]"),b=g.siblings(".plus"),R=g.siblings(".minus"),_=l.find(".cs-adults input[name=adult-quantity]"),k=_.siblings(".plus"),C=_.siblings(".minus"),x=l.find(".cs-children input[name=child-quantity]"),y=x.siblings(".plus"),D=x.siblings(".minus"),s=T.closest(".cs-form-field.cs-check-in"),r=A.closest(".cs-form-field.cs-check-out"),t=r.length?r.outerHeight(!0):0,u=l.find(".cs-form-field.cs-rooms > .cs-form-notice"),m=l.children(".cs-form-error-message"),f=l.children(".cs-form-success-message"),U=d(".room-availability-calendar-wrapper .hidden-calendar"),$=U.length,ie=parseInt(loftoceanRoomReservation.guestLimitation.min,10),se=parseInt(loftoceanRoomReservation.guestLimitation.max,10),te=!isNaN(ie)&&0<ie,oe=!isNaN(se)&&0<se,re=!ee&&!l.find(".cs-form-field.cs-children").hasClass("hide"),ne=!ee&&!l.find(".cs-form-field.cs-adults").hasClass("hide"),_e=parseInt(loftoceanRoomReservation.guestLimitation.maxAdult,10),ke=parseInt(loftoceanRoomReservation.guestLimitation.maxChild,10),be=!isNaN(_e)&&0<_e,Re=!isNaN(ke)&&0<ke,ae=te||oe||Re||be,z=Te(""),d.each(loftoceanRoomReservation.priceList,function(e,a){("unavailable"==a.status||a.available_number<1)&&(ue.push(a.start),me.push(a.end))});var e=function(){if(loftoceanRoomReservation.passParamsFromSearchResultPage){var e=loftoceanRoomReservation.searchResultParams.checkin,a=loftoceanRoomReservation.searchResultParams.checkout,t=moment(e),o=moment(a),i=Ye(t);if(i[0]&&(!i[1]||!i[1].split(" ").includes("checkin-unavailable"))){t=Ye(o,{startDate:t,endDate:null});if(t[0]&&(!t[1]||!t[1].split(" ").includes("checkout-unavailable")))return{checkin:e,checkout:a}}}return Ge(moment(),moment().add("1","day"))}(),o=e.checkin,i=e.checkout;T.val(moment(o).format(Q)).data("value",o),A.val(moment(i).format(Q)).data("value",i),j=o,G=Te(new Date(j)),F=i,H=Te(new Date(F)),Y=Xe(_.val()),W=Xe(x.val()),B=Xe(g.val()),S=E=M=I=0,L=l.find(".cs-form-field-group.date-group"),(O=L.length)&&(V=T.siblings("span.input"),q=A.siblings("span.input"),V.text(moment(o).format(Q)),q.text(moment(i).format(Q))),loftoceanRoomReservation.variablePrices.enable&&"[object Object]"==Object.prototype.toString.call(loftoceanRoomReservation.variablePrices.prices)&&(loftoceanRoomReservation.pricePerPerson&&"per_person"==loftoceanRoomReservation.variablePrices.mode||!loftoceanRoomReservation.pricePerPerson&&"per_person"!=loftoceanRoomReservation.variablePrices.mode)&&(Ce=!0,ye=void 0!==loftoceanRoomReservation.variablePrices.guestMode&&"group"==loftoceanRoomReservation.variablePrices.guestMode,void 0!==loftoceanRoomReservation.variablePrices.enableWeekendPrice&&loftoceanRoomReservation.variablePrices.enableWeekendPrice,xe=loftoceanRoomReservation.variablePrices.prices);var n=l.find(".date-range-picker");$&&U.daterangepicker({parentEl:".room-availability-calendar-wrapper",minDate:moment().format(fe),maxDate:moment().add(loftoceanRoomReservation.maximalMonthsAllowedForBooking,"M").format(fe),startDate:o,endDate:i,alwaysShowCalendars:!0,buttonClasses:l.length?"btn btn-sm":"btn btn-sm hide",disableButtons:!l.length,locale:{format:fe,applyLabel:loftoceanRoomReservation.availabilityCalendarText.apply,cancelLabel:loftoceanRoomReservation.availabilityCalendarText.cancel},beforeShowDay:Ye}).trigger("click").on("apply.daterangepicker",function(e,a){a.show();var t=a.startDate.format(fe),a=a.endDate.format(fe);l.length&&(n.val(t+" - "+a),We(t,a),d("html, body").animate({scrollTop:T.offset().top-window.innerHeight/2},200))}).on("cancel.daterangepicker",function(e,a){a.show(),a.setStartDate(o),a.setEndDate(i),a.updateView()}).on("outsideClick.daterangepicker",function(e,a){a.show()}),l.length&&(d("#content.site-content.with-sidebar-right").length&&n.addClass("pull-right"),n.daterangepicker({minDate:moment().format(fe),maxDate:moment().add(loftoceanRoomReservation.maximalMonthsAllowedForBooking,"M").format(fe),startDate:o,endDate:i,locale:{format:fe},autoApply:!0,beforeShowDay:Ye}).on("apply.daterangepicker",function(e,a){var t,o=a.startDate.format(fe),i=a.endDate.format(fe);d(this).val(o+" - "+i),We(o,i),$&&((t=U.data("daterangepicker")).setStartDate(o),t.setEndDate(i),t.updateView()),O?L.removeClass("loftocean-highlighted"):(s.removeClass("loftocean-highlighted"),r.removeClass("loftocean-highlighted"),a.container.css({transform:"",transition:""}))}).on("show.daterangepicker",function(e,a){a.popupSingle=!1,a.container.removeClass("single").find(".drp-calendar.right").show(),a.container.outerWidth(!0)<558?(a.popupSingle=!0,a.container.addClass("single").find(".drp-calendar.right").hide()):(a.popupSingle=!1,a.container.removeClass("single").find(".drp-calendar.right").show()),a.renderCalendar("left"),O?L.addClass("loftocean-highlighted"):(s.addClass("loftocean-highlighted"),r.removeClass("loftocean-highlighted"))}).on("setStartDate.daterangepicker",function(e,a){O?(V.text(a.startDate.format(Q)),q.css("opacity",0)):(T.val(a.startDate.format(Q)),A.val(""),s.removeClass("loftocean-highlighted"),r.addClass("loftocean-highlighted"),a.container.css({transform:"translateY("+t+"px)",transition:"0.15s"}))}).on("outsideClick.daterangepicker",function(e,a){a.oldStartDate&&(O?(V.text(a.oldStartDate.format(Q)),q.text(a.oldEndDate.format(Q)).css("opacity","")):(T.val(a.oldStartDate.format(Q)),A.val(a.oldEndDate.format(Q)))),O?L.removeClass("loftocean-highlighted"):(s.removeClass("loftocean-highlighted"),r.removeClass("loftocean-highlighted"),a.container.css({transform:"",transition:""}))}),l.find(".field-input-wrap.checkin-date, .field-input-wrap.checkout-date, .cs-form-field-group.date-group .cs-form-field-group-inner").on("click",function(e){var a=n.data("daterangepicker"),t=moment(T.data("value")?T.data("value"):""),o=moment(A.data("value")?A.data("value"):""),t=t.isValid()?t:moment(),o=o.isAfter(t)?o:t.clone().add("1","day"),t=function(e,a){var t=Ye(e);if(t[0]&&(!t[1]||!t[1].split(" ").includes("checkin-unavailable"))){t=Ye(a,{startDate:e,endDate:null});if(t[0]&&(!t[1]||!t[1].split(" ").includes("checkout-unavailable")))return{checkin:e.format(fe),checkout:a.format(fe)}}return Ge(e,a)}(t,o),o=t.checkin,t=t.checkout;a.setStartDate(o),a.setEndDate(t),a.show()})),v.length&&(Z.on("click",function(e){var a=d(this);v.hasClass("hide")?(a.addClass("toggled-on"),v.removeClass("hide")):(a.removeClass("toggled-on"),v.addClass("hide"))}),Z.hasClass("default-hide")||Z.trigger("click"),Z.hasClass("always-show")&&Z.off("click")),l.on("change",".cs-form-group.cs-extra-service-group .label-checkbox .extra-service-switcher",function(){Se(),Ae()}).on("click",".cs-form-group.cs-extra-service-group .extra-service-custom-quantity button",function(e){setTimeout(function(){Se(),Ae()},50)}),g.on("loftocean.number.changed",function(e,a,t){t.data("status")&&"disabled"==t.data("status")||(B=Xe(g.val()),Ue(),Ae(),Ne(),Ke())}).parent().on("click","button",function(e){u.removeClass("show"),clearTimeout(he)}),_.on("loftocean.number.changed",function(e,a,t){e.preventDefault(),t.data("status")&&"disabled"==t.data("status")||(Y=Xe(_.val()),Ie(),Se(),Ae(),(loftoceanRoomReservation.pricePerPerson||loftoceanRoomReservation.variablePrices.enable)&&we(),Ke())}).parent().on("click","button",function(e,a){if(void 0===a){var t=d(this).hasClass("plus"),o=Qe("adult",t);if(!(!!t||ze(!0))||!o)return e.preventDefault(),e.stopImmediatePropagation(),!1}else a&&(k.removeClass("disabled").data("status",""),C.removeClass("disabled").data("status",""),y.removeClass("disabled").data("status",""),D.removeClass("disabled").data("status",""))}),x.on("loftocean.number.changed",function(e,a,t){e.preventDefault(),t.data("status")&&"disabled"==t.data("status")||(W=Xe(x.val()),Ie(),Se(),Ae(),(loftoceanRoomReservation.pricePerPerson||loftoceanRoomReservation.variablePrices.enable)&&we(),Ke())}).parent().on("click","button",function(e,a){if(void 0===a){var t=d(this).hasClass("plus"),o=Qe("child",t);if(!(!!t||ze(!1))||!o)return e.preventDefault(),e.stopImmediatePropagation(),!1}else a&&(k.removeClass("disabled").data("status",""),C.removeClass("disabled").data("status",""),y.removeClass("disabled").data("status",""),D.removeClass("disabled").data("status",""))}),d("body").on("click",function(e){var a=d(e.target),t=d(".csf-base-price-breakdown"),e=d(".cs-service-description.show");!t.length||a.hasClass("csf-base-price-breakdown")||a.parents(".csf-base-price-breakdown").length||t.parent().hasClass("always-show")||d(".csf-base-price-breakdown").removeClass("show"),!e.length||a.hasClass("cs-service-description")||a.parents(".cs-service-description").length||e.removeClass("show")}).on("mouseenter",".daterangepicker-has-tooltip",function(){var e=d(this).find(".day-tooltip");e.length&&e.removeClass("hide")}).on("mouseleave",".daterangepicker-has-tooltip",function(){var e=d(this).find(".day-tooltip");e.length&&e.addClass("hide")}),l.on("click",".csf-pd-total-base .csf-pd-label",function(e){e.stopImmediatePropagation(),e.stopPropagation(),d(this).parent().hasClass("always-show")||((e=d(this).siblings(".csf-base-price-breakdown")).hasClass("show")?e.removeClass("show"):(d(".cs-service-description.show").removeClass("show"),e.addClass("show")))}).on("click",".cs-form-field.cs-extra-service.has-description .info-indicator",function(e){e.stopImmediatePropagation(),e.stopPropagation();e=d(this).closest(".cs-extra-service.has-description").find(".cs-service-description");e.length&&(e.hasClass("show")?e.removeClass("show"):(d(".cs-service-description.show, .csf-base-price-breakdown.show").removeClass("show"),e.addClass("show")))}).on("click",".cs-submit button",function(e){e.preventDefault();var a={roomID:loftoceanRoomReservation.roomID,action:loftoceanRoomReservation.addRoomToCartAjaxAction};return l.find("input,select,cheeckbox").serializeArray().forEach(function(e){a[e.name]=e.value}),a.checkin=T.data("value"),a.checkout=A.data("value"),m.html(""),f.html(""),h.addClass("loading"),d.ajax(loftoceanRoomReservation.ajaxURL,{method:"POST",data:a}).done(function(e,a){var t=!1;"success"==a&&"object"==typeof(e=e?JSON.parse(e):{})&&(e.message?(t=!0,m.html("<p>"+e.message+"</p>")):e.redirect&&(t=!0,f.html("<p>"+N.bookingSuccess+"</p>"),setTimeout(function(){window.location.href=loftoceanRoomReservation.cartPage},500))),t||m.html("<p>"+N.bookingError+"</p>")}).fail(function(){m.html("<p>"+N.bookingError+"</p>")}).always(function(){h.removeClass("loading")}),!1}),l.length&&(re?(_.data("min",0).val(1).siblings(".minus").trigger("click",!0),x.data("min",1).val(0).siblings(".plus").trigger("click",!0)):Ke(),Ue(),He(G,H),Pe(),h.removeClass("loading"))})}(jQuery);